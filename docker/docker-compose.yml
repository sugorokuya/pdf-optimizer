# Enhanced pikepdf Docker Compose
# ç°¡å˜ã«PDFæœ€é©åŒ–ç’°å¢ƒã‚’èµ·å‹•

version: '3.8'

services:
  enhanced-pikepdf:
    build:
      context: .
      dockerfile: Dockerfile.enhanced-pikepdf
    image: enhanced-pikepdf:latest
    container_name: enhanced-pikepdf-optimizer
    volumes:
      # PDFãƒ•ã‚¡ã‚¤ãƒ«ç”¨ã®ãƒœãƒªãƒ¥ãƒ¼ãƒ 
      - ./pdfs:/data
      # Enhanced pikepdfã‚½ãƒ¼ã‚¹ï¼ˆé–‹ç™ºæ™‚ï¼‰
      - /Users/maltakoji/Plant/enhanced-pikepdf:/app/enhanced-pikepdf-source:ro
    environment:
      - PYTHONUNBUFFERED=1
    command: /app/help.sh
    
  # é–‹ç™ºç”¨ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆå¯¾è©±çš„ä½¿ç”¨ï¼‰
  enhanced-pikepdf-dev:
    build:
      context: .
      dockerfile: Dockerfile.enhanced-pikepdf
    image: enhanced-pikepdf:latest
    container_name: enhanced-pikepdf-dev
    volumes:
      - ./pdfs:/data
      - /Users/maltakoji/Plant/enhanced-pikepdf:/app/enhanced-pikepdf-source:ro
    environment:
      - PYTHONUNBUFFERED=1
    command: bash
    stdin_open: true
    tty: true
    
  # ãƒãƒƒãƒå‡¦ç†ç”¨ã‚µãƒ¼ãƒ“ã‚¹
  enhanced-pikepdf-batch:
    build:
      context: .
      dockerfile: Dockerfile.enhanced-pikepdf
    image: enhanced-pikepdf:latest
    volumes:
      - ./input-pdfs:/data/input:ro
      - ./output-pdfs:/data/output
    environment:
      - PYTHONUNBUFFERED=1
    command: bash -c "
      echo 'ğŸš€ Enhanced pikepdf Batch Processing';
      for pdf in /data/input/*.pdf; do
        if [ -f \"$$pdf\" ]; then
          filename=$$(basename \"$$pdf\");
          output=\"/data/output/$${filename%.*}_optimized.pdf\";
          echo \"Processing: $$filename\";
          python enhanced_pdf_optimizer_integrated.py \"$$pdf\" -o \"$$output\" -v;
        fi;
      done;
      echo 'âœ… Batch processing completed';
      "
    profiles:
      - batch